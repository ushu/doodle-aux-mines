import pytest_asyncio
from db import DB
from db.models import Chain, ChainElement
from test.conftest import test_database

UGLY_IMAGE = "data:image/png;base64,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AQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQKTEvj/4o/hsrLk+NUAAAAASUVORK5CYII="

#
# FACTORIES
#

async def create_chain(is_active: bool = False):
    row = await test_database.fetch_one(
        """
        INSERT INTO chains (is_active)
        VALUES (:is_active)
        RETURNING *
        """,
        {"is_active": is_active}
    )
    return Chain(**row)

async def create_chain_element(chain_id: int, order_number: int, content: str, type: str, player_name: str):
    row = await test_database.fetch_one(
        """
        INSERT INTO chain_elements (chain_id, order_number, content, type, player_name)
        VALUES (:chain_id, :order_number, :content, :type, :player_name)
        RETURNING *
        """,
        {"chain_id": chain_id, "order_number": order_number, "content": content, "type": type, "player_name": player_name}
    )
    return ChainElement(**row)

#
# FIXTURES
#

@pytest_asyncio.fixture
async def empty_chain():
    return await create_chain()

# @pytest.fixture
# async def active_chain():
#     return await create_chain(is_active=True)

@pytest_asyncio.fixture
async def chain_with_two_elements():
    chain = await create_chain()
    await create_chain_element(chain_id=chain.id, order_number=1, content="hello", type="text", player_name="John")
    await create_chain_element(chain_id=chain.id, order_number=2, content=UGLY_IMAGE, type="drawing", player_name="Jane")
    return chain

@pytest_asyncio.fixture
async def chain_with_three_elements():
    chain = await create_chain()
    await create_chain_element(chain_id=chain.id, order_number=1, content="hello", type="text", player_name="John")
    await create_chain_element(chain_id=chain.id, order_number=2, content=UGLY_IMAGE, type="drawing", player_name="Jane")
    await create_chain_element(chain_id=chain.id, order_number=3, content="Still here", type="text", player_name="John")
    return chain

